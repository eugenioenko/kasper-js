!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class r{constructor(e,t,s){this.value=e,this.line=t,this.col=s}toString(){return this.value.toString()}}class i{}class n extends i{constructor(e,t,s,r,i=0){super(),this.type="element",this.name=e,this.attributes=t,this.children=s,this.self=r,this.line=i}accept(e,t){return e.visitElementKNode(this,t)}toString(){return"KNode.Element"}}class a extends i{constructor(e,t,s=0){super(),this.type="attribute",this.name=e,this.value=t,this.line=s}accept(e,t){return e.visitAttributeKNode(this,t)}toString(){return"KNode.Attribute"}}class h extends i{constructor(e,t=0){super(),this.type="text",this.value=e,this.line=t}accept(e,t){return e.visitTextKNode(this,t)}toString(){return"KNode.Text"}}class o extends i{constructor(e,t=0){super(),this.type="comment",this.value=e,this.line=t}accept(e,t){return e.visitCommentKNode(this,t)}toString(){return"KNode.Comment"}}class c extends i{constructor(e,t=0){super(),this.type="doctype",this.value=e,this.line=t}accept(e,t){return e.visitDoctypeKNode(this,t)}toString(){return"KNode.Doctype"}}var u;!function(e){e[e.Eof=0]="Eof",e[e.Panic=1]="Panic",e[e.Ampersand=2]="Ampersand",e[e.AtSign=3]="AtSign",e[e.Caret=4]="Caret",e[e.Comma=5]="Comma",e[e.Dollar=6]="Dollar",e[e.Dot=7]="Dot",e[e.Hash=8]="Hash",e[e.LeftBrace=9]="LeftBrace",e[e.LeftBracket=10]="LeftBracket",e[e.LeftParen=11]="LeftParen",e[e.Percent=12]="Percent",e[e.Pipe=13]="Pipe",e[e.RightBrace=14]="RightBrace",e[e.RightBracket=15]="RightBracket",e[e.RightParen=16]="RightParen",e[e.Semicolon=17]="Semicolon",e[e.Slash=18]="Slash",e[e.Star=19]="Star",e[e.Arrow=20]="Arrow",e[e.Bang=21]="Bang",e[e.BangEqual=22]="BangEqual",e[e.Colon=23]="Colon",e[e.Equal=24]="Equal",e[e.EqualEqual=25]="EqualEqual",e[e.Greater=26]="Greater",e[e.GreaterEqual=27]="GreaterEqual",e[e.Less=28]="Less",e[e.LessEqual=29]="LessEqual",e[e.Minus=30]="Minus",e[e.MinusEqual=31]="MinusEqual",e[e.MinusMinus=32]="MinusMinus",e[e.PercentEqual=33]="PercentEqual",e[e.Plus=34]="Plus",e[e.PlusEqual=35]="PlusEqual",e[e.PlusPlus=36]="PlusPlus",e[e.Question=37]="Question",e[e.QuestionDot=38]="QuestionDot",e[e.QuestionQuestion=39]="QuestionQuestion",e[e.SlashEqual=40]="SlashEqual",e[e.StarEqual=41]="StarEqual",e[e.DotDot=42]="DotDot",e[e.DotDotDot=43]="DotDotDot",e[e.LessEqualGreater=44]="LessEqualGreater",e[e.Identifier=45]="Identifier",e[e.Template=46]="Template",e[e.String=47]="String",e[e.Number=48]="Number",e[e.And=49]="And",e[e.Const=50]="Const",e[e.False=51]="False",e[e.Instanceof=52]="Instanceof",e[e.New=53]="New",e[e.Null=54]="Null",e[e.Undefined=55]="Undefined",e[e.Of=56]="Of",e[e.Or=57]="Or",e[e.True=58]="True",e[e.Typeof=59]="Typeof",e[e.With=60]="With"}(u||(u={}));class l{constructor(e,t,s,r,i){this.name=u[e],this.type=e,this.lexeme=t,this.literal=s,this.line=r,this.col=i}toString(){return`[(${this.line}):"${this.lexeme}"]`}}const p=[" ","\n","\t","\r"],d=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];class m{parse(e){for(this.current=0,this.line=1,this.col=1,this.source=e,this.errors=[],this.nodes=[];!this.eof();)try{const e=this.node();if(null===e)continue;this.nodes.push(e)}catch(e){if(e instanceof r)this.errors.push(`Parse Error (${e.line}:${e.col}) => ${e.value}`);else if(this.errors.push(""+e),this.errors.length>10)return this.errors.push("Parse Error limit exceeded"),this.nodes;break}return this.source="",this.nodes}match(...e){for(const t of e)if(this.check(t))return this.current+=t.length,!0;return!1}advance(e=""){this.eof()?this.error("Unexpected end of file. "+e):(this.check("\n")&&(this.line+=1,this.col=0),this.col+=1,this.current++)}peek(...e){for(const t of e)if(this.check(t))return!0;return!1}check(e){return this.source.slice(this.current,this.current+e.length)===e}eof(){return this.current>this.source.length}error(e){throw new r(e,this.line,this.col)}node(){let e;return this.whitespace(),this.match("</")&&this.error("Unexpected closing tag"),e=this.match("\x3c!--")?this.comment():this.match("<!doctype")||this.match("<!DOCTYPE")?this.doctype():this.match("<")?this.element():this.text(),this.whitespace(),e}comment(){const e=this.current;do{this.advance("Expected comment closing '--\x3e'")}while(!this.match("--\x3e"));const t=this.source.slice(e,this.current-3);return new o(t,this.line)}doctype(){const e=this.current;do{this.advance("Expected closing doctype")}while(!this.match(">"));const t=this.source.slice(e,this.current-1).trim();return new c(t,this.line)}element(){const e=this.line,t=this.identifier("/",">");t||this.error("Expected a tag name");const s=this.attributes();if(this.match("/>")||d.includes(t)&&this.match(">"))return new n(t,s,[],!0,this.line);this.match(">")||this.error("Expected closing tag");let r=[];return this.whitespace(),this.peek("</")||(r=this.children(t)),this.close(t),new n(t,s,r,!1,e)}close(e){this.match("</")||this.error(`Expected </${e}>`),this.match(""+e)||this.error(`Expected </${e}>`),this.whitespace(),this.match(">")||this.error(`Expected </${e}>`)}children(e){const t=[];do{this.eof()&&this.error(`Expected </${e}>`);const s=this.node();null!==s&&t.push(s)}while(!this.peek("</"));return t}attributes(){const e=[];for(;!this.peek(">","/>")&&!this.eof();){this.whitespace();const t=this.line,s=this.identifier("=",">","/>");s||this.error("Blank attribute name"),this.whitespace();let r="";this.match("=")&&(this.whitespace(),r=this.match("'")?this.string("'"):this.match('"')?this.string('"'):this.identifier(">","/>")),this.whitespace(),e.push(new a(s,r,t))}return e}text(){const e=this.current,t=this.line;for(;!this.peek("<")&&!this.eof();)this.advance();const s=this.source.slice(e,this.current).trim();return s?new h(s,t):null}whitespace(){let e=0;for(;this.peek(...p)&&!this.eof();)e+=1,this.advance();return e}identifier(...e){this.whitespace();const t=this.current;for(;!this.peek(...p,...e);)this.advance("Expected closing "+e);const s=this.current;return this.whitespace(),this.source.slice(t,s).trim()}string(e){const t=this.current;for(;!this.match(e);)this.advance("Expected closing "+e);return this.source.slice(t,this.current-1)}}class f{constructor(){}}class v extends f{constructor(e,t,s){super(),this.name=e,this.value=t,this.line=s}accept(e){return e.visitAssignExpr(this)}toString(){return"Expr.Assign"}}class x extends f{constructor(e,t,s,r){super(),this.left=e,this.operator=t,this.right=s,this.line=r}accept(e){return e.visitBinaryExpr(this)}toString(){return"Expr.Binary"}}class g extends f{constructor(e,t,s,r){super(),this.callee=e,this.paren=t,this.args=s,this.line=r}accept(e){return e.visitCallExpr(this)}toString(){return"Expr.Call"}}class E extends f{constructor(e,t){super(),this.properties=e,this.line=t}accept(e){return e.visitDictionaryExpr(this)}toString(){return"Expr.Dictionary"}}class k extends f{constructor(e,t,s,r){super(),this.name=e,this.key=t,this.iterable=s,this.line=r}accept(e){return e.visitEachExpr(this)}toString(){return"Expr.Each"}}class w extends f{constructor(e,t,s,r){super(),this.entity=e,this.key=t,this.type=s,this.line=r}accept(e){return e.visitGetExpr(this)}toString(){return"Expr.Get"}}class y extends f{constructor(e,t){super(),this.expression=e,this.line=t}accept(e){return e.visitGroupingExpr(this)}toString(){return"Expr.Grouping"}}class b extends f{constructor(e,t){super(),this.name=e,this.line=t}accept(e){return e.visitKeyExpr(this)}toString(){return"Expr.Key"}}class S extends f{constructor(e,t,s,r){super(),this.left=e,this.operator=t,this.right=s,this.line=r}accept(e){return e.visitLogicalExpr(this)}toString(){return"Expr.Logical"}}class P extends f{constructor(e,t){super(),this.value=e,this.line=t}accept(e){return e.visitListExpr(this)}toString(){return"Expr.List"}}class T extends f{constructor(e,t){super(),this.value=e,this.line=t}accept(e){return e.visitLiteralExpr(this)}toString(){return"Expr.Literal"}}class q extends f{constructor(e,t){super(),this.clazz=e,this.line=t}accept(e){return e.visitNewExpr(this)}toString(){return"Expr.New"}}class N extends f{constructor(e,t,s){super(),this.left=e,this.right=t,this.line=s}accept(e){return e.visitNullCoalescingExpr(this)}toString(){return"Expr.NullCoalescing"}}class C extends f{constructor(e,t,s){super(),this.name=e,this.increment=t,this.line=s}accept(e){return e.visitPostfixExpr(this)}toString(){return"Expr.Postfix"}}class L extends f{constructor(e,t,s,r){super(),this.entity=e,this.key=t,this.value=s,this.line=r}accept(e){return e.visitSetExpr(this)}toString(){return"Expr.Set"}}class D extends f{constructor(e,t){super(),this.value=e,this.line=t}accept(e){return e.visitTemplateExpr(this)}toString(){return"Expr.Template"}}class B extends f{constructor(e,t,s,r){super(),this.condition=e,this.thenExpr=t,this.elseExpr=s,this.line=r}accept(e){return e.visitTernaryExpr(this)}toString(){return"Expr.Ternary"}}class A extends f{constructor(e,t){super(),this.value=e,this.line=t}accept(e){return e.visitTypeofExpr(this)}toString(){return"Expr.Typeof"}}class K extends f{constructor(e,t,s){super(),this.operator=e,this.right=t,this.line=s}accept(e){return e.visitUnaryExpr(this)}toString(){return"Expr.Unary"}}class M extends f{constructor(e,t){super(),this.name=e,this.line=t}accept(e){return e.visitVariableExpr(this)}toString(){return"Expr.Variable"}}class ${constructor(){this.errorLevel=1}parse(e){this.current=0,this.tokens=e,this.errors=[];const t=[];for(;!this.eof();)try{t.push(this.expression())}catch(e){if(e instanceof r)this.errors.push(`Parse Error (${e.line}:${e.col}) => ${e.value}`);else if(this.errors.push(""+e),this.errors.length>100)return this.errors.push("Parse Error limit exceeded"),t;this.synchronize()}return t}match(...e){for(const t of e)if(this.check(t))return this.advance(),!0;return!1}advance(){return this.eof()||this.current++,this.previous()}peek(){return this.tokens[this.current]}previous(){return this.tokens[this.current-1]}check(e){return this.peek().type===e}eof(){return this.check(u.Eof)}consume(e,t){return this.check(e)?this.advance():this.error(this.peek(),t+`, unexpected token "${this.peek().lexeme}"`)}error(e,t){throw new r(t,e.line,e.col)}synchronize(){do{if(this.check(u.Semicolon)||this.check(u.RightBrace))return void this.advance();this.advance()}while(!this.eof())}foreach(e){this.current=0,this.tokens=e,this.errors=[],this.consume(u.Const,'Expected const definition starting "each" statement');const t=this.consume(u.Identifier,'Expected an identifier inside "each" statement');let s=null;this.match(u.With)&&(s=this.consume(u.Identifier,'Expected a "key" identifier after "with" keyword in foreach statement')),this.consume(u.Of,'Expected "of" keyword inside foreach statement');const r=this.expression();return new k(t,s,r,t.line)}expression(){const e=this.assignment();if(this.match(u.Semicolon))for(;this.match(u.Semicolon););return e}assignment(){const e=this.ternary();if(this.match(u.Equal,u.PlusEqual,u.MinusEqual,u.StarEqual,u.SlashEqual)){const t=this.previous();let s=this.assignment();if(e instanceof M){const r=e.name;return t.type!==u.Equal&&(s=new x(new M(r,r.line),t,s,t.line)),new v(r,s,r.line)}if(e instanceof w)return t.type!==u.Equal&&(s=new x(new w(e.entity,e.key,e.type,e.line),t,s,t.line)),new L(e.entity,e.key,s,e.line);this.error(t,"Invalid l-value, is not an assigning target.")}return e}ternary(){const e=this.nullCoalescing();if(this.match(u.Question)){const t=this.ternary();this.consume(u.Colon,'Expected ":" after ternary ? expression');const s=this.ternary();return new B(e,t,s,e.line)}return e}nullCoalescing(){const e=this.logicalOr();if(this.match(u.QuestionQuestion)){const t=this.nullCoalescing();return new N(e,t,e.line)}return e}logicalOr(){let e=this.logicalAnd();for(;this.match(u.Or);){const t=this.previous(),s=this.logicalAnd();e=new S(e,t,s,t.line)}return e}logicalAnd(){let e=this.equality();for(;this.match(u.And);){const t=this.previous(),s=this.equality();e=new S(e,t,s,t.line)}return e}equality(){let e=this.addition();for(;this.match(u.BangEqual,u.EqualEqual,u.Greater,u.GreaterEqual,u.Less,u.LessEqual);){const t=this.previous(),s=this.addition();e=new x(e,t,s,t.line)}return e}addition(){let e=this.modulus();for(;this.match(u.Minus,u.Plus);){const t=this.previous(),s=this.modulus();e=new x(e,t,s,t.line)}return e}modulus(){let e=this.multiplication();for(;this.match(u.Percent);){const t=this.previous(),s=this.multiplication();e=new x(e,t,s,t.line)}return e}multiplication(){let e=this.typeof();for(;this.match(u.Slash,u.Star);){const t=this.previous(),s=this.typeof();e=new x(e,t,s,t.line)}return e}typeof(){if(this.match(u.Typeof)){const e=this.previous(),t=this.typeof();return new A(t,e.line)}return this.unary()}unary(){if(this.match(u.Minus,u.Bang,u.Dollar,u.PlusPlus,u.MinusMinus)){const e=this.previous(),t=this.unary();return new K(e,t,e.line)}return this.newKeyword()}newKeyword(){if(this.match(u.New)){const e=this.previous(),t=this.call();return new q(t,e.line)}return this.call()}call(){let e=this.primary(),t=!0;do{if(t=!1,this.match(u.LeftParen)){t=!0;do{const t=[];if(!this.check(u.RightParen))do{t.push(this.expression())}while(this.match(u.Comma));const s=this.consume(u.RightParen,'Expected ")" after arguments');e=new g(e,s,t,s.line)}while(this.match(u.LeftParen))}this.match(u.Dot,u.QuestionDot)&&(t=!0,e=this.dotGet(e,this.previous())),this.match(u.LeftBracket)&&(t=!0,e=this.bracketGet(e,this.previous()))}while(t);return e}dotGet(e,t){const s=this.consume(u.Identifier,"Expect property name after '.'"),r=new b(s,s.line);return new w(e,r,t.type,s.line)}bracketGet(e,t){let s=null;return this.check(u.RightBracket)||(s=this.expression()),this.consume(u.RightBracket,'Expected "]" after an index'),new w(e,s,t.type,t.line)}primary(){if(this.match(u.False))return new T(!1,this.previous().line);if(this.match(u.True))return new T(!0,this.previous().line);if(this.match(u.Null))return new T(null,this.previous().line);if(this.match(u.Undefined))return new T(void 0,this.previous().line);if(this.match(u.Number)||this.match(u.String))return new T(this.previous().literal,this.previous().line);if(this.match(u.Template))return new D(this.previous().literal,this.previous().line);if(this.match(u.Identifier)){const e=this.previous();return this.match(u.PlusPlus)?new C(e,1,e.line):this.match(u.MinusMinus)?new C(e,-1,e.line):new M(e,e.line)}if(this.match(u.LeftParen)){const e=this.expression();return this.consume(u.RightParen,'Expected ")" after expression'),new y(e,e.line)}if(this.match(u.LeftBrace))return this.dictionary();if(this.match(u.LeftBracket))return this.list();throw this.error(this.peek(),`Expected expression, unexpected token "${this.peek().lexeme}"`)}dictionary(){const e=this.previous();if(this.match(u.RightBrace))return new E([],this.previous().line);const t=[];do{if(this.match(u.String,u.Identifier,u.Number)){const e=this.previous();if(this.match(u.Colon)){const s=this.expression();t.push(new L(null,new b(e,e.line),s,e.line))}else{const s=new M(e,e.line);t.push(new L(null,new b(e,e.line),s,e.line))}}else this.error(this.peek(),"String, Number or Identifier expected as a Key of Dictionary {, unexpected token "+this.peek().lexeme)}while(this.match(u.Comma));return this.consume(u.RightBrace,'Expected "}" after object literal'),new E(t,e.line)}list(){const e=[],t=this.previous();if(this.match(u.RightBracket))return new P([],this.previous().line);do{e.push(this.expression())}while(this.match(u.Comma));return this.consume(u.RightBracket,'Expected "]" after array declaration'),new P(e,t.line)}}function G(e){return e>="0"&&e<="9"}function R(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}class O{scan(e){for(this.source=e,this.tokens=[],this.errors=[],this.current=0,this.start=0,this.line=1,this.col=1;!this.eof();){this.start=this.current;try{this.getToken()}catch(e){if(this.errors.push(""+e),this.errors.length>100)return this.errors.push("Error limit exceeded"),this.tokens}}return this.tokens.push(new l(u.Eof,"",null,this.line,0)),this.tokens}eof(){return this.current>=this.source.length}advance(){return"\n"===this.peek()&&(this.line++,this.col=0),this.current++,this.col++,this.source.charAt(this.current-1)}addToken(e,t){const s=this.source.substring(this.start,this.current);this.tokens.push(new l(e,s,t,this.line,this.col))}match(e){return!this.eof()&&(this.source.charAt(this.current)===e&&(this.current++,!0))}peek(){return this.eof()?"\0":this.source.charAt(this.current)}peekNext(){return this.current+1>=this.source.length?"\0":this.source.charAt(this.current+1)}comment(){for(;"\n"!==this.peek()&&!this.eof();)this.advance()}multilineComment(){for(;!this.eof()&&("*"!==this.peek()||"/"!==this.peekNext());)this.advance();this.eof()?this.error('Unterminated comment, expecting closing "*/"'):(this.advance(),this.advance())}string(e){for(;this.peek()!==e&&!this.eof();)this.advance();if(this.eof())return void this.error("Unterminated string, expecting closing "+e);this.advance();const t=this.source.substring(this.start+1,this.current-1);this.addToken("`"!==e?u.String:u.Template,t)}number(){for(;G(this.peek());)this.advance();for("."===this.peek()&&G(this.peekNext())&&this.advance();G(this.peek());)this.advance();for("e"===this.peek().toLowerCase()&&(this.advance(),"-"!==this.peek()&&"+"!==this.peek()||this.advance());G(this.peek());)this.advance();const e=this.source.substring(this.start,this.current);this.addToken(u.Number,Number(e))}identifier(){for(;R(e=this.peek())||G(e);)this.advance();var e;const t=this.source.substring(this.start,this.current),s=(r=t).charAt(0).toUpperCase()+r.substr(1).toLowerCase();var r;!function(e){return u[e]>=u.And}(s)?this.addToken(u.Identifier,t):this.addToken(u[s],t)}getToken(){const e=this.advance();switch(e){case"(":this.addToken(u.LeftParen,null);break;case")":this.addToken(u.RightParen,null);break;case"[":this.addToken(u.LeftBracket,null);break;case"]":this.addToken(u.RightBracket,null);break;case"{":this.addToken(u.LeftBrace,null);break;case"}":this.addToken(u.RightBrace,null);break;case",":this.addToken(u.Comma,null);break;case";":this.addToken(u.Semicolon,null);break;case"^":this.addToken(u.Caret,null);break;case"$":this.addToken(u.Dollar,null);break;case"#":this.addToken(u.Hash,null);break;case":":this.addToken(this.match("=")?u.Arrow:u.Colon,null);break;case"*":this.addToken(this.match("=")?u.StarEqual:u.Star,null);break;case"%":this.addToken(this.match("=")?u.PercentEqual:u.Percent,null);break;case"|":this.addToken(this.match("|")?u.Or:u.Pipe,null);break;case"&":this.addToken(this.match("&")?u.And:u.Ampersand,null);break;case">":this.addToken(this.match("=")?u.GreaterEqual:u.Greater,null);break;case"!":this.addToken(this.match("=")?u.BangEqual:u.Bang,null);break;case"?":this.addToken(this.match("?")?u.QuestionQuestion:this.match(".")?u.QuestionDot:u.Question,null);break;case"=":this.addToken(this.match("=")?u.EqualEqual:this.match(">")?u.Arrow:u.Equal,null);break;case"+":this.addToken(this.match("+")?u.PlusPlus:this.match("=")?u.PlusEqual:u.Plus,null);break;case"-":this.addToken(this.match("-")?u.MinusMinus:this.match("=")?u.MinusEqual:u.Minus,null);break;case"<":this.addToken(this.match("=")?this.match(">")?u.LessEqualGreater:u.LessEqual:u.Less,null);break;case".":this.match(".")?this.match(".")?this.addToken(u.DotDotDot,null):this.addToken(u.DotDot,null):this.addToken(u.Dot,null);break;case"/":this.match("/")?this.comment():this.match("*")?this.multilineComment():this.addToken(this.match("=")?u.SlashEqual:u.Slash,null);break;case"'":case'"':case"`":this.string(e);break;case"\n":case" ":case"\r":case"\t":break;default:G(e)?this.number():R(e)?this.identifier():this.error(`Unexpected character '${e}'`)}}error(e){throw new Error(`Scan Error (${this.line}:${this.col}) => ${e}`)}}class Q{constructor(e,t){this.parent=e||null,this.init(t)}init(e){this.values=e?new Map(Object.entries(e)):new Map}set(e,t){this.values.set(e,t)}get(e){return this.values.has(e)?this.values.get(e):null!==this.parent?this.parent.get(e):void 0}}class I{constructor(){this.scope=new Q,this.errors=[],this.scanner=new O,this.parser=new $}evaluate(e){return e.result=e.accept(this)}error(e){throw new Error("Runtime Error => "+e)}visitVariableExpr(e){return this.scope.get(e.name.lexeme)}visitAssignExpr(e){const t=this.evaluate(e.value);return this.scope.set(e.name.lexeme,t),t}visitKeyExpr(e){return e.name.literal}visitGetExpr(e){const t=this.evaluate(e.entity),s=this.evaluate(e.key);if(t||e.type!==u.QuestionDot)return t[s]}visitSetExpr(e){const t=this.evaluate(e.entity),s=this.evaluate(e.key),r=this.evaluate(e.value);return t[s]=r,r}visitPostfixExpr(e){const t=this.scope.get(e.name.lexeme),s=t+e.increment;return this.scope.set(e.name.lexeme,s),t}visitListExpr(e){const t=[];for(const s of e.value){const e=this.evaluate(s);t.push(e)}return t}templateParse(e){const t=this.scanner.scan(e),s=this.parser.parse(t);this.parser.errors.length&&this.error("Template string  error: "+this.parser.errors[0]);let r="";for(const e of s)r+=this.evaluate(e).toString();return r}visitTemplateExpr(e){return e.value.replace(/\{\{([\s\S]+?)\}\}/g,(e,t)=>this.templateParse(t))}visitBinaryExpr(e){const t=this.evaluate(e.left),s=this.evaluate(e.right);switch(e.operator.type){case u.Minus:case u.MinusEqual:return t-s;case u.Slash:case u.SlashEqual:return t/s;case u.Star:case u.StarEqual:return t*s;case u.Percent:case u.PercentEqual:return t%s;case u.Plus:case u.PlusEqual:return t+s;case u.Pipe:return t|s;case u.Caret:return t^s;case u.Greater:return t>s;case u.GreaterEqual:return t>=s;case u.Less:return t<s;case u.LessEqual:return t<=s;case u.EqualEqual:return t===s;case u.BangEqual:return t!==s;default:return this.error("Unknown binary operator "+e.operator),null}}visitLogicalExpr(e){const t=this.evaluate(e.left);if(e.operator.type===u.Or){if(t)return t}else if(!t)return t;return this.evaluate(e.right)}visitTernaryExpr(e){return this.evaluate(e.condition).isTruthy()?this.evaluate(e.thenExpr):this.evaluate(e.elseExpr)}visitNullCoalescingExpr(e){const t=this.evaluate(e.left);return t||this.evaluate(e.right)}visitGroupingExpr(e){return this.evaluate(e.expression)}visitLiteralExpr(e){return e.value}visitUnaryExpr(e){const t=this.evaluate(e.right);switch(e.operator.type){case u.Minus:return-t;case u.Bang:return!t;case u.PlusPlus:case u.MinusMinus:const s=Number(t)+(e.operator.type===u.PlusPlus?1:-1);if(e.right instanceof M)this.scope.set(e.right.name.lexeme,s);else if(e.right instanceof w){const t=new L(e.right.entity,e.right.key,new T(s,e.line),e.line);this.evaluate(t)}else this.error("Invalid right-hand side expression in prefix operation:  "+e.right);return s;default:return this.error("Unknown unary operator ' + expr.operator"),null}}visitCallExpr(e){const t=this.evaluate(e.callee);"function"!=typeof t&&this.error(t+" is not a function");const s=[];for(const t of e.args)s.push(this.evaluate(t));return t(...s)}visitNewExpr(e){const t=e.clazz,s=this.evaluate(t.callee);"function"!=typeof s&&this.error(`'${s}' is not a class. 'new' statement must be used with classes.`);const r=[];for(const e of t.args)r.push(this.evaluate(e));return new s(...r)}visitDictionaryExpr(e){const t={};for(const s of e.properties){const e=this.evaluate(s.key),r=this.evaluate(s.value);t[e]=r}return t}visitTypeofExpr(e){return typeof this.evaluate(e.value)}visitEachExpr(e){return[e.name.lexeme,e.key?e.key.lexeme:null,this.evaluate(e.iterable)]}}class U{constructor(){this.scanner=new O,this.parser=new $,this.interpreter=new I,this.errors=[]}evaluate(e,t){e.accept(this,t)}execute(e){const t=this.scanner.scan(e);return this.parser.parse(t).map(e=>this.interpreter.evaluate(e))}transpile(e,t){const s=document.createElement("kasper");this.interpreter.scope.init(t),this.errors=[];for(const t of e)try{this.evaluate(t,s)}catch(e){console.error(""+e)}return s}visitElementKNode(e,t){const s=e.attributes.find(e=>"@each"===e.name);if(s){const r=this.scanner.scan(s.value),[i,n,a]=this.interpreter.evaluate(this.parser.foreach(r)),h=this.interpreter.scope;let o=0;for(const s of a){const r={[i]:s};n&&(r[n]=o),this.interpreter.scope=new Q(h,r),this.createElementKNode(e,t),o+=1}return void(this.interpreter.scope=h)}const r=e.attributes.find(e=>"@if"===e.name);if(r){const s=this.execute(r.value);s&&s.length&&s[0]&&this.createElementKNode(e,t)}else this.createElementKNode(e,t)}createElementKNode(e,t){const s=document.createElement(e.name);e.attributes.filter(e=>!e.name.startsWith("@")).map(e=>this.evaluate(e,s)),e.self||(e.children.map(e=>this.evaluate(e,s)),t&&t.appendChild(s))}visitAttributeKNode(e,t){const s=document.createAttribute(e.name);e.value&&(s.value=e.value),t&&t.setAttributeNode(s)}templateParse(e){const t=this.scanner.scan(e),s=this.parser.parse(t);this.parser.errors.length&&this.error("Template string  error: "+this.parser.errors[0]);let r="";for(const e of s)r+=""+this.interpreter.evaluate(e);return r}visitTextKNode(e,t){let s;if(/\{\{.+\}\}/.test(e.value)){const t=e.value.replace(/\{\{([\s\S]+?)\}\}/g,(e,t)=>this.templateParse(t));s=document.createTextNode(t)}else s=document.createTextNode(e.value);t&&t.appendChild(s)}visitCommentKNode(e,t){const s=new Comment(e.value);t&&t.appendChild(s)}visitDoctypeKNode(e){}error(e){throw new Error("Runtime Error => "+e)}}class j{constructor(){this.errors=[]}evaluate(e){return e.accept(this)}transpile(e){this.errors=[];const t=[];for(const s of e)try{t.push(this.evaluate(s))}catch(e){if(console.error(""+e),this.errors.push(""+e),this.errors.length>100)return this.errors.push("Error limit exceeded"),t}return t}visitElementKNode(e){let t=e.attributes.map(e=>this.evaluate(e)).join(" ");if(t.length&&(t=" "+t),e.self)return`<${e.name}${t}/>`;const s=e.children.map(e=>this.evaluate(e)).join("");return`<${e.name}${t}>${s}</${e.name}>`}visitAttributeKNode(e){return e.value?`${e.name}="${e.value}"`:e.name}visitTextKNode(e){return e.value}visitCommentKNode(e){return`\x3c!-- ${e.value} --\x3e`}visitDoctypeKNode(e){return`<!doctype ${e.value}>`}error(e){throw new Error("Runtime Error => "+e)}}"undefined"!=typeof window?(window||{}).kasper={demoJson:'\n{\n  "person": {\n    "name": "John Doe",\n    "profession": "Software Developer",\n    "age": 21,\n    "hobbies": ["reading", "music", "golf"]\n  }\n}\n',demoSourceCode:'\n<div id="top" role="document">\n  <header>\n    <h3>{{person.name}}</h3>\n    <h4>{{person.profession}}</h4>\n    <p @if="person.age > 21">Age is greater then 21</p>\n    <p @if="person.age == 21">Age is equal to 21</p>\n    <p @if="person.age < 21">Age is less then 21</p>\n  </header>\n  <h4>Hobbies ({{person.hobbies.length}}):</h4>\n  <ul>\n    <li @each="const hobby with index of person.hobbies" class="text-red">\n      {{index + 1}}: {{hobby}}\n    </li>\n  </ul>\n  <div>100 + 20 / (10 * (10 -20) + 4) = {{100 + 20 / (10 * (10 -20) + 4)}}</div>\n</div>\n',execute:function(e){const t=new m,s=t.parse(e);return t.errors.length?JSON.stringify(t.errors):JSON.stringify(s)},transpile:function(e,t){const s=(new m).parse(e);return(new U).transpile(s,t)}}:"undefined"!=typeof exports&&(exports.kasper={ExpressionParser:$,Interpreter:I,Scanner:O,TemplateParser:m,Transpiler:U,Viewer:j})}]);